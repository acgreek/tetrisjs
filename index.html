<!DOCTYPE html>
<html>
    <head>
    <style>
html,
body {
    width: 100%;
    height: 100%;
    margin: 0;

}
canvas {
    background: #CCC;
    display: block;
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    width: 100%;
    height: 100%;

}
    </style>
    </style>
        <!-- Load the Paper.js library -->
        <script type="text/javascript" src="js/paper-full.js"></script>
        <!-- Load external PaperScript and associate it with myCanvas -->
        <script type="text/paperscript" canvas="myCanvas">
document.getElementById("myCanvas").style.background = 'black';
// Create a Paper.js Path to draw a line into it:
var path = new Path();
// Give the stroke a color
path.strokeColor = 'red';
var x = 300;
var y = 100;
var start = new Point(x, y);
// Move to start and draw a line from there
path.moveTo(start);
// Note the plus operator on Point objects.
// PaperScript does that for us, and much more!
path.lineTo(start + [ 100, -50 ]);
var rotationRate = 3;
var gameBoard = new Path.Rectangle(10,1, 9*9,9*9*3);
gameBoard.fillColor = 'white';
var blist = new Array();
var date = new Date();
var lastTime = date.getTime();

var pieceIdx=0;

function Piece () {
    this.bstart=0;
    this.bend=4;
}
function buildSquarePiece(blist) {
    var np = new Piece();
    np.bstart = pieceIdx;
    blist.push(new Path.Rectangle(10,1, 9,9));
    blist[pieceIdx].fillColor = 'red';
    pieceIdx = pieceIdx+1;
    blist.push(new Path.Rectangle(10+9,1, 9,9));
    blist[pieceIdx].fillColor = 'red';
    pieceIdx = pieceIdx+1;
    blist.push(new Path.Rectangle(10,1+9, 9,9));
    blist[pieceIdx].fillColor = 'red';
    pieceIdx = pieceIdx+1;
    blist.push(new Path.Rectangle(10+9,1+9, 9,9));
    blist[pieceIdx].fillColor = 'red';
    pieceIdx = pieceIdx+1;
    np.bend = pieceIdx; 
    return np;
}
function pieceToLeft(curPiece) {
    for (var i = curPiece.bstart; i < curPiece.bend; i++) {
       if (14.5 ==  blist[i].position.x) {
         return true;
       }
    }
    return false;
}
function pieceToRight(curPiece) {
    for (var i = curPiece.bstart; i < curPiece.bend; i++) {
       if (86.5 ==  blist[i].position.x) {
         return true;
       }
    }
    return false;
}
function pieceToBottom(curPiece) {
    for (var i = curPiece.bstart; i < curPiece.bend; i++) {
       if (239.5 ==  blist[i].position.y) {
         return true;
       }
    }
    return false;
}
function movePieceHorrizontal(curPiece, q) {
    for (var i = curPiece.bstart; i < curPiece.bend; i++) {
       blist[i].position.x=blist[i].position.x + q;
    }
}
function movePieceVertical(curPiece, q) {
    for (var i = curPiece.bstart; i < curPiece.bend; i++) {
       blist[i].position.y=blist[i].position.y + q;
    }
}
var curPiece = buildSquarePiece(blist);

function rotateLine() {
//    Each framesetcols, rotate the path by 3 degrees:
    path.rotate(rotationRate);
//    path.fillColor.hue += 1;
}
var readKeyTimeout =  0;
function onFrame(event) {
    rotateLine();

    date = new Date();
    var now = date.getTime();

    if (Key.isDown('q')) {
        x =  x-1;
    }
    if (Key.isDown('w')) {
        x =  x+1;
    }
    start = new Point(x, y);
    path.position = start;

    if (Key.isDown('d')) {
	if (!pieceToRight(curPiece) && (now- readKeyTimeout) > 150) { 
	    movePieceHorrizontal(curPiece, 9);
	    readKeyTimeout = now;
	}
    }
    if (Key.isDown('a')) {
	if (!pieceToLeft(curPiece) && (now- readKeyTimeout) > 150) {
	    movePieceHorrizontal(curPiece, -9);
	    readKeyTimeout = now;
	} 
    }
    if (Key.isDown('s')) {
	if (!pieceToBottom(curPiece) && (now- readKeyTimeout) > 150) {
	    movePieceVertical(curPiece, 9);
	    readKeyTimeout = now;
	} 
    }
    if ((now - lastTime) > 1000) {
	if (pieceToBottom(curPiece)) { 
		curPiece = buildSquarePiece(blist);
        }
        else { 
	    movePieceVertical(curPiece, 9);
        }
        lastTime = now;
    }
}
function onKeyUp(event) {
     if (event.key == 'space') {
        }
        if (event.key == 'z') {
            rotationRate = rotationRate+1;
        }
        // Show stats:
        if (event.key == 'x') {
            rotationRate = rotationRate-1;
        }
    }

        </script>
    </head>
    <body>
        <canvas id="myCanvas" resize></canvas> </canvas>
    </body>
</html>

